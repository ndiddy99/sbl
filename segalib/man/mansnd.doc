*******************************************************************************
●ドキュメント種別      ：3ndSTEP(1994-08-22) -> 3rdSTEP(1994-11-22) 変更点
●対象ライブラリ記号名称：snd
●対象ライブラリ名称    ：サウンドＩ／Ｆ
●バージョン　　        ：1.05
●作成者                ：N.T
●作成日                ：1994-11-22
●その他のメッセージ    ：なし
*******************************************************************************

※Ver1.02からVer1.04は個別対応で配布したものです。

///////////////////////////////////////////////////////////////////////////////
◆変更バージョンへの移行作業時の注意
///////////////////////////////////////////////////////////////////////////////
    ！！重要！！
        ヘッダファイルを変更していますので、ヘッダファイルをインクルードしてい
        るユーザプログラムを必ずリコンパイルしてください。

///////////////////////////////////////////////////////////////////////////////
◆変更履歴
///////////////////////////////////////////////////////////////////////////////
    ●1994-09-23 Ver1.02
    ●1994-10-12 Ver1.03
    ●1994-11-11 Ver1.04
    ●1994-11-22 Ver1.05

///////////////////////////////////////////////////////////////////////////////
◆変更詳細　Ｖｅｒ１．０２
///////////////////////////////////////////////////////////////////////////////
■不良対策
    3rdSTEPの不良の対策を以下のように行いました。

        ●1.SND_Init()のメモリゼロクリア部分の不良対策
            誤ってmemcpyを使用していた部分をmemsetへ変更しました。
            
        ●2.SND_SetCdDaLev()のパラメータ処理の不良対策
            マニュアルのパラメータ(0〜7)の設定ではCD-DAの音が出力されない不良
            がありました。これをマニュアルのパラメータ指定で音が出力されるよう
            にしました。
            
        ●3.PCMのPAN設定の不良対策
            SND_StartPcm()でのPAN設定が右に振ることができない不良がありました
            。これはサウンドドライバの不良です。サウンドドライバのVer.1.12を使
            用ください。(94-08-22のサウンドドライバはVer1.11です。）

■仕様変更
    3rdSTEPからの仕様変更を以下のように行いました。

        ●1.SND_StartPcm()のPCM開始オフセット設定の削除
            PCM開始オフセット設定機能を削除しました。

■その他
    CD-DAとPCMストリームの同時再生サンプルプログラムを追加しました。SMPSND5で
    す。SMPSND4を改造して作成しました。

///////////////////////////////////////////////////////////////////////////////
◆変更詳細　Ｖｅｒ１．０３
///////////////////////////////////////////////////////////////////////////////
■仕様変更
    DMAライブラリの変更により（Ver1.01[1994-08-22] -> Ver1.02[1994-09-30]）
    サウンドＩ／Ｆライブラリの内部仕様が変更になりました。また外部仕様も一部変
    更になりました。変更詳細を以下に示します。

    ●内部仕様変更
        SND_Init()内にSCU DMAの高水準初期化関数であるDMA_ScuInit()を追加しまし
        た。DMA_ScuInit()は割込み処理内で実行してはいけないため、SND_Init()は
        割込み処理内で実行しないようにしてください。

    ●外部仕様変更
        ●SND_Init()を割込み処理内で実行しないようにしてください。（詳細は内部
        　仕様変更参照）

        ●デフォルトの割込み優先度の場合、SND_MoveData()を割込み処理内で使用し
        　ないようにしてください。割込み処理内で使用するためには、割込み優先度
        　をDMA終了割込みが割込み処理内で取得できるように変更してください。割
        　込み優先度を変更するにはシステムライブラリを使用してください。サウン
        　ドのサンプルプログラム(SMPSND4)に例を示してあります。
        　
■マニュアルへの追加
    ●サウンドメモリへのアクセスについて
        サウンドメモリへ頻繁にアクセスすることを禁止します。ホスト側(SH)からサ
        ウンドメモリへ頻繁にアクセスすると、そのメモリはサウンドドライバが見る
        ことができないため、サウンドドライバが動作しなくなります。
        
        　（例）SND_StartSeq(1,0,0,0);
                while(SND_SEQ_STAT_MODE(status) == SND_MD_STOP){
                    SND_GetSeqStat(&status, 0);
                }
                
                上記の場合、永久ループしてしまう可能性があります。理由はホスト
                側がステータスのメモリを頻繁にアクセスするため、シーケンスが終
                了してもサウンドドライバがSTOPのシーケンスをステータスのメモリ
                へ書き込めないためです。
        
■サンプルプログラムの修正
    ●SMPSND3.C
        このサンプルを削除します。理由はこのサンプルで使用している割込みステー
        タスレジスタがSCUのハード制限のため使用できなくなったためです。

    ●SMPSND4.C
        割込み優先度を変更し、サウンドリクエスト割込み処理内で、SND_MoveData()
        を使用できるように変更しました。
        
    ●SMPSND5.C
        ●CDC_Init()のパラメータ変更
            CDCライブラリの制限による変更を行いました。パラメータを次のように
            しました。
                CDC_Init(0x00, 0x00, 0x05, 0x0f);

        ●割込み優先度を変更し、サウンドリクエスト割込み処理内で、SND_MoveData
          ()を使用できるように変更しました。

///////////////////////////////////////////////////////////////////////////////
◆変更詳細　Ｖｅｒ１．０４
///////////////////////////////////////////////////////////////////////////////
■内部仕様変更
    ●Cinepakライブラリと併用した場合の問題点対策
        CinepakライブラリVer1.04 と同時に使用した場合、Cinepakライブラリムービ
        の再生が停止してしまうことがありました。
        これはサウンドＩ／Ｆライブラリがすべてのコマンドブロック番号を使用する
        ため、同じコマンドブロック番号を両方のライブラリが使用してしまうためで
        す。
        サウンドＩ／Ｆライブラリ側の対策として、サウンドのコマンドを発行する際
        コマンドブロックの空き状態確認からコマンド設定(判断)を終了するまでの間
        割り込みマスクを立てておき、コマンド設定を破壊しないようにしました。
        Cinepakライブラリ側も Ver1.05で同様の対策をしました。必ず Ver1.05 以降
        を使用してください。
        (Cinepakライブラリ Ver1.04，サウンドＩ／Ｆライブラリ Ver1.03とも単体の
        動作には問題ありません．）
        
■コンパイルオプションの変更
        ライブラリのコンパイルオプションの/SPを/NOSPへ変更しました。理由は、/SP
        でコンパイルすると関数がインライン展開されてしまうのでデバッグ時に混乱
        を招く恐れがあるためです。

///////////////////////////////////////////////////////////////////////////////
◆変更詳細　Ｖｅｒ１．０５
///////////////////////////////////////////////////////////////////////////////
■サウンドドライバ変更による変更
    サウンドドライバの仕様が変更されたため、サウンドＩ／Ｆライブラリを変更しま
    した。
    
    ●変更概略
        ・修正
            (1)SND_ChgMap時の手順修正
        
        ・追加
            (2)DSP中止コマンド追加
            (3)全サウンド発音中止コマンド追加
            (4)シーケンスPAN設定コマンド追加
            (5)サウンドコントロール設定（STEREO/MONOモード設定）コマンド追加

    ●変更マニュアル
        ◆関数仕様
            ・サウンドコントロール - 共通
                +---------------------------------------------------+
                | サウンドエリアマップ変更  | SND_ChgMap            |
                +---------------------------------------------------+
                ....
                ★★★★★　お願い　★★★★★
                サウンドエリアマップ変更時に音がなっていたり、DSPが動作中だっ
                た場合に、マップを切り替えたり、使用中のサウンドデータを入れ替
                えたりするとサウンドドライバシステムが暴走する場合があります。
                よって以下のことを必ず守ってください。

                    サウンドエリアマップ変更関数は、CD-DAの音がなっていないと
                    きに、以下の２つのコマンドを実行した後に実行してください。
                        
                        ・DSP中止関数
                        ・全サウンド発音中止関数

                +---------------------------------------------------+
                | DSP中止           |SND_StopDsp                    |
                +---------------------------------------------------+
                書式    SndRet SND_StopDsp(void)
                入力    なし
                出力    なし
                関数値  コマンド実行状態
                機能    DSPマイクロプログラムの実行を中止します。
        
                +---------------------------------------------------+
                | 全サウンド発音中止           |SND_OffAllSound     |
                +---------------------------------------------------+
                書式    SndRet SND_OffAllSound(void)
                入力    なし
                出力    なし
                関数値  コマンド実行状態
                機能    全サウンド発音を中止します。
        
            ・サウンドコントロール - シーケンス
                +---------------------------------------------------+
                | シーケンスPAN設定         |SND_SetSeqPan          |
                +---------------------------------------------------+
                書式    SndRet SND_SetSeqPan(SndSeqNum seq_no, Uint8 ctrl_sw,
                                             Uint8 md_pan)
                入力    seq_no  ：発音管理番号
                        ctrl_sw ：コントロールスイッチ
                            SND_SEQ_PAN_ON  = Control ON
                            SND_SEQ_PAN_OFF = Control OFF
                        md_pan  ：MIDI PAN data
                            値の範囲    0x00〜0x7f
                            値の意味
                                +---------------------------+
                                | left <-- Center --> Right |
                                +---------------------------+
                                | 0x00 <--  0x40  --> 0x7f  |
                                +---------------------------+
                出力    なし
                関数値  コマンド実行状態
                機能    シーケンスのPANを設定します。（詳細はサウンド開発マニ
                        ュアルのサウンドドライバシステムインタフェースをご覧く
                        ださい。）

            ・その他
                +---------------------------------------------------+
                | サウンドコントロール設定      | SND_SET_SND_CTRL  |
                +---------------------------------------------------+
                書式    void SND_SET_SND_CTRL(Uint8 snd_ctrl)
                入力    サウンドコントロール値
                            SND_CTRL_OUTPUT_STEREO  ：ステレオ
                            SND_CTRL_OUTPUT_MONO    ：モノラル
                出力    なし
                関数値  なし
                機能    サウンドコントロール値を設定します。現在はステレオ／モ
                        ノラルのモードを選択し設定できます。
        
                +---------------------------------------------------+
                | サウンドコントロール取得      | SND_GET_SND_CTRL  |
                +---------------------------------------------------+
                書式    Uint8 SND_GET_SND_CTRL(void)
                入力    なし
                出力    サウンドコントロール値
                            SND_CTRL_OUTPUT_STEREO  ：ステレオ
                            SND_CTRL_OUTPUT_MONO    ：モノラル
                関数値  なし
                機能    サウンドコントロール値を取得します。
        
■その他
    ●サンプルプログラムの修正
        smpsnd1の126行目に必要のないコーディングが含まれていましたので削除しま
        した。
            126行目：*(Uint32 *)0x600ff00 = 1; <--削除
            
    ●サンプルプログラムのPCMデータについて
        smpsnd4とsmpsnd5に使用しているPCMデータ音を聞くと、おかしな曲に聞
        こえます。ハード、及びソフトの不具合ではありません。PCMデータがおかし
        いためです。ご了承ください。
        
********************************** end of file ********************************
